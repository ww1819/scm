<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
	<th:block th:include="include :: header('供应商证件审核')" />
</head>
<body>
    <div class="main-content" style="padding-bottom: 80px;">
        <form id="form-supplier-certificate-audit" class="form-horizontal">
            <input name="certificateId" type="hidden" th:value="${supplierCertificate.certificateId}"/>
            <h4 class="form-header h4">供应商证件信息</h4>
            <div class="row">
                <div class="col-sm-6">
                    <div class="form-group">
                        <label class="col-sm-4 control-label">供应商：</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" th:value="${supplierCertificate.supplierName}" readonly>
                        </div>
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="form-group">
                        <label class="col-sm-4 control-label">证件类型：</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" th:value="${supplierCertificate.certificateType}" readonly>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-6">
                    <div class="form-group">
                        <label class="col-sm-4 control-label">证件名称：</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" th:value="${supplierCertificate.certificateName}" readonly>
                        </div>
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="form-group">
                        <label class="col-sm-4 control-label">证件编号：</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" th:value="${supplierCertificate.certificateNo}" readonly>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-6">
                    <div class="form-group">
                        <label class="col-sm-4 control-label">发证日期：</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" th:value="${supplierCertificate.issueDate != null ? #dates.format(supplierCertificate.issueDate, 'yyyy-MM-dd') : ''}" readonly>
                        </div>
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="form-group">
                        <label class="col-sm-4 control-label">有效期至：</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" th:value="${supplierCertificate.expireDate != null ? #dates.format(supplierCertificate.expireDate, 'yyyy-MM-dd') : ''}" readonly>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row" th:if="${supplierCertificate.certificateFile != null and supplierCertificate.certificateFile != ''}">
                <div class="col-sm-12">
                    <div class="form-group">
                        <label class="col-xs-2 control-label">证件图片：</label>
                        <div class="col-xs-10">
                            <a th:href="@{${supplierCertificate.certificateFile}}" target="_blank" class="btn btn-xs btn-info">
                                <i class="fa fa-image"></i> 查看证件图片
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <h4 class="form-header h4">审核信息</h4>
            <div class="row">
                <div class="col-sm-6">
                    <div class="form-group">
                        <label class="col-sm-4 control-label is-required">审核状态：</label>
                        <div class="col-sm-8">
                            <select name="auditStatus" class="form-control" required>
                                <option value="1" th:selected="${supplierCertificate.auditStatus == '1'}">已审核</option>
                                <option value="2" th:selected="${supplierCertificate.auditStatus == '2'}">已拒绝</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-12">
                    <div class="form-group">
                        <label class="col-xs-2 control-label">审核备注：</label>
                        <div class="col-xs-10">
                            <textarea name="auditRemark" maxlength="500" class="form-control" rows="3" placeholder="请输入审核备注" th:text="${supplierCertificate.auditRemark}"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
      
    <div class="row" style="position: fixed; bottom: 0; left: 0; right: 0; background-color: #fff; padding: 15px 20px; border-top: 1px solid #ddd; z-index: 1000; box-shadow: 0 -2px 8px rgba(0,0,0,0.1);">
        <div class="col-sm-offset-5 col-sm-10">
            <button type="button" class="btn btn-sm btn-primary" onclick="submitHandler()"><i class="fa fa-check"></i>保 存</button>&nbsp;
            <button type="button" class="btn btn-sm btn-danger" onclick="closeItem()"><i class="fa fa-reply-all"></i>关 闭</button>
        </div>
    </div>
    <div style="height: 70px;"></div>
	<th:block th:include="include :: footer" />
	<script>
	    var prefix = ctx + "certificate/supplier";
	
        $("#form-supplier-certificate-audit").validate({
        	onkeyup: false,
        	rules:{
        		auditStatus:{
        			required: true
        		}
        	},
            focusCleanup: true
        });
        
        function submitHandler() {
	        if ($.validate.form()) {
	        	$.operate.saveTab(prefix + "/audit", $("#form-supplier-certificate-audit").serializeArray());
	        }
	    }
	    
	    function closeItem() {
	        if (window.parent && window.parent !== window) {
	            try {
	                if (typeof window.parent.closeItem === 'function') {
	                    window.parent.closeItem();
	                    return;
	                }
	            } catch(e) {
	                console.log("调用父窗口closeItem失败:", e);
	            }
	            
	            try {
	                var topWindow = $(window.parent.document);
	                var closeBtn = $('.page-tabs-content .active i', topWindow);
	                if (closeBtn.length > 0) {
	                    closeBtn.click();
	                    return;
	                }
	            } catch(e) {
	                console.error("关闭标签页失败:", e);
	            }
	        }
	        
	        try {
	            if (typeof $.modal !== 'undefined' && typeof $.modal.closeTab === 'function') {
	                $.modal.closeTab();
	                return;
	            }
	        } catch(e) {
	            console.log("使用$.modal.closeTab失败:", e);
	        }
	        
	        console.warn("无法关闭页面，请手动关闭标签页");
	    }
    </script>
</body>
</html>

