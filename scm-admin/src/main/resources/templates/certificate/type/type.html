<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head>
	<th:block th:include="include :: header('证件类型列表')" />
	<th:block th:include="include :: layout-latest-css" />
	<style>
		.type-nav-box {
			border: 1px solid #e7eaec;
			border-radius: 4px;
			background: #fff;
			padding: 15px;
			margin-top: 10px;
		}
		.type-nav-box .nav-title {
			font-size: 16px;
			font-weight: bold;
			margin-bottom: 15px;
			padding-bottom: 10px;
			border-bottom: 2px solid #337ab7;
			color: #333;
		}
		.type-nav-box .nav-item {
			display: block;
			padding: 12px 15px;
			margin-bottom: 10px;
			background: #f5f5f5;
			border: 1px solid #ddd;
			border-radius: 4px;
			color: #333;
			text-decoration: none;
			transition: all 0.3s;
			cursor: pointer;
		}
		.type-nav-box .nav-item:hover {
			background: #337ab7;
			color: #fff;
			border-color: #337ab7;
			text-decoration: none;
		}
		.type-nav-box .nav-item.active {
			background: #337ab7;
			color: #fff;
			border-color: #337ab7;
			font-weight: bold;
		}
		.type-nav-box .nav-item i {
			margin-right: 8px;
		}
	</style>
</head>
<body class="gray-bg">
	<div class="container-div">
		<div class="row">
			<!-- 左侧：类型框 -->
			<div class="col-sm-3">
				<div class="type-nav-box">
					<div class="nav-title">
						<i class="fa fa-list"></i> 证件类型
					</div>
					<a href="javascript:void(0)" class="nav-item" data-category="product" onclick="selectCertificateCategory('product', this)">
						<i class="fa fa-file-text-o"></i> 产品证件维护
					</a>
					<a href="javascript:void(0)" class="nav-item" data-category="supplier" onclick="selectCertificateCategory('supplier', this)">
						<i class="fa fa-building-o"></i> 企业证件维护
					</a>
					<a href="javascript:void(0)" class="nav-item" data-category="manufacturer" onclick="selectCertificateCategory('manufacturer', this)">
						<i class="fa fa-id-card"></i> 生产厂家证件维护
					</a>
				</div>
			</div>
			
			<!-- 右侧：证件类型列表 -->
			<div class="col-sm-9">
				<div class="col-sm-12 search-collapse">
					<form id="certificate-type-form">
						<div class="select-list">
							<ul>
								<li>
									类型编码：<input type="text" name="typeCode"/>
								</li>
								<li>
									类型名称：<input type="text" name="typeName"/>
								</li>
								<li>
								类型分类：<select name="typeCategory">
									<option value="">所有</option>
									<option value="supplier">企业证件</option>
									<option value="product">产品证件</option>
									<option value="manufacturer">生产厂家证件</option>
								</select>
								</li>
								<li>
									状态：<select name="status">
										<option value="">所有</option>
										<option value="0">正常</option>
										<option value="1">停用</option>
									</select>
								</li>
								<li>
									<a class="btn btn-primary btn-rounded btn-sm" onclick="$.table.search()"><i class="fa fa-search"></i>&nbsp;搜索</a>
									<a class="btn btn-warning btn-rounded btn-sm" onclick="resetPre()"><i class="fa fa-refresh"></i>&nbsp;重置</a>
								</li>
							</ul>
						</div>
					</form>
				</div>
				
		        <div class="btn-group-sm" id="toolbar" role="group">
		        	<a class="btn btn-success" onclick="handleAdd()" shiro:hasPermission="certificate:type:add">
		                <i class="fa fa-plus"></i> 新增
		            </a>
		             <a class="btn btn-primary single disabled" onclick="$.operate.editTab()" shiro:hasPermission="certificate:type:edit">
			            <i class="fa fa-edit"></i> 修改
			        </a>
		            <a class="btn btn-danger multiple disabled" onclick="$.operate.removeAll()" shiro:hasPermission="certificate:type:remove">
		                <i class="fa fa-remove"></i> 删除
		            </a>
		            <a class="btn btn-warning" onclick="$.table.exportExcel()" shiro:hasPermission="certificate:type:export">
			            <i class="fa fa-download"></i> 导出
			        </a>
		            <a class="btn btn-info" onclick="openConfig()" shiro:hasPermission="certificate:type:view">
			            <i class="fa fa-cog"></i> 配置
			        </a>
		        </div>
		        
		        <div class="col-sm-12 select-table table-striped">
				    <table id="bootstrap-table"></table>
				</div>
			</div>
		</div>
	</div>
	
	<th:block th:include="include :: footer" />
	<th:block th:include="include :: layout-latest-js" />
	<script th:inline="javascript">
		var editFlag = [[${@permission.hasPermi('certificate:type:edit')}]];
		var removeFlag = [[${@permission.hasPermi('certificate:type:remove')}]];
		var prefix = ctx + "certificate/type";
		var selectedCategory = null; // 当前选中的证件类型分类

		$(function() {
		    queryCertificateTypeList();
		});

		function queryCertificateTypeList() {
		    var options = {
		        id: "bootstrap-table",
		        formId: "certificate-type-form",
		        url: prefix + "/list",
		        createUrl: prefix + "/add",
		        updateUrl: prefix + "/edit/{id}",
		        removeUrl: prefix + "/remove",
		        exportUrl: prefix + "/export",
		        sortName: "orderNum",
		        sortOrder: "asc",
		        modalName: "证件类型",
		        uniqueId: "typeId",
		        columns: [{
		            checkbox: true,
		            field: 'state'
		        },
		        {
		            field: 'typeId',
		            title: '类型ID',
		            visible: false
		        },
		        {
		            field: 'typeCode',
		            title: '编码',
		            sortable: true
		        },
		        {
		            field: 'typeName',
		            title: '值',
		            formatter: function (value, row, index) {
		                return value || '-';
		            }
		        },
		        {
		            field: 'description',
		            title: '说明',
		            formatter: function (value, row, index) {
		                return value || '-';
		            }
		        },
		        {
		        	field: 'status',
		        	title: '启用状态',
		        	align: 'center',
		        	formatter: function (value, row, index) {
		        		if (row.status == '0') {
		        			return '<span class="label label-success">启用</span>';
		        		} else {
		        			return '<span class="label label-danger">停用</span>';
		        		}
		        	}
		        },
		        {
		            field: 'orderNum',
		            title: '排序',
		            sortable: true,
		            align: 'center'
		        },
		        {
		            field: 'remark',
		            title: '备注',
		            formatter: function (value, row, index) {
		                return value || '-';
		            }
		        }]
		    };
		    $.table.init(options);
		}
		
		function resetPre() {
			$("#certificate-type-form")[0].reset();
			$.table.search();
		}
		
		// 选择证件类型分类
		function selectCertificateCategory(category, element) {
			// 移除所有active类
			$('.type-nav-box .nav-item').removeClass('active');
			// 添加active类到当前选中的项
			$(element).addClass('active');
			// 保存选中的分类
			selectedCategory = category;
			
			// 根据选择的分类筛选右侧列表
			var $typeCategorySelect = $('#certificate-type-form select[name="typeCategory"]');
			if (category === 'product') {
				$typeCategorySelect.val('product');
			} else if (category === 'supplier') {
				$typeCategorySelect.val('supplier');
			} else if (category === 'manufacturer') {
				$typeCategorySelect.val('manufacturer');
			}
			
			// 刷新表格，使用新的筛选条件
			var $table = $('#bootstrap-table');
			if ($table.length > 0 && $table.data('bootstrap.table')) {
				// 如果表格已初始化，直接刷新
				$table.bootstrapTable('refresh');
			} else {
				// 如果表格未初始化，使用搜索功能
				setTimeout(function() {
					$.table.search('certificate-type-form');
				}, 100);
			}
		}
		
		// 处理新增按钮点击
		function handleAdd() {
			if (!selectedCategory) {
				$.modal.msgWarning("请先选择左侧的证件类型");
				return;
			}
			
			// 构建新增URL，传递类型分类参数
			var addUrl = prefix + "/add?typeCategory=" + selectedCategory;
			$.operate.addTab(addUrl, '新增证件类型');
		}
		
		// 打开配置页面
		function openConfig() {
			var url = prefix + "/config";
			$.operate.addTab(url, '证件过期预警配置');
		}
		
		// 导航到证件维护页面
		function navigateToCertificate(type) {
			var url = '';
			if (type === 'product') {
				url = ctx + 'certificate/product';
			} else if (type === 'supplier') {
				url = ctx + 'certificate/supplier';
			}
			if (url) {
				$.operate.addTab(url, '证件维护');
			}
		}
	</script>
</body>
</html>

