<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.scm.system.mapper.MaterialDictMapper">
    
    <resultMap type="MaterialDict" id="MaterialDictResult">
        <id     property="materialId"        column="material_id"        />
        <result property="materialCode"      column="material_code"      />
        <result property="materialName"      column="material_name"      />
        <result property="specification"     column="specification"      />
        <result property="model"            column="model"              />
        <result property="unit"             column="unit"                />
        <result property="categoryId"        column="category_id"        />
        <result property="manufacturerId"    column="manufacturer_id"    />
        <result property="purchasePrice"    column="purchase_price"     />
        <result property="status"           column="status"              />
        <result property="delFlag"          column="del_flag"            />
        <result property="createBy"         column="create_by"           />
        <result property="createTime"       column="create_time"         />
        <result property="updateBy"         column="update_by"           />
        <result property="updateTime"       column="update_time"         />
        <result property="remark"            column="remark"              />
    </resultMap>
    
    <sql id="selectMaterialDictVo">
        select m.material_id, m.material_code, m.material_name, m.specification, m.model, m.unit,
               m.category_id, m.manufacturer_id, m.purchase_price, m.status, m.del_flag,
               m.create_by, m.create_time, m.update_by, m.update_time, m.remark,
               c.category_name, man.manufacturer_name
        from scm_material_dict m
        left join scm_material_category c on m.category_id = c.category_id and c.del_flag = '0'
        left join scm_manufacturer man on m.manufacturer_id = man.manufacturer_id and man.del_flag = '0'
    </sql>
    
    <select id="selectMaterialDictList" parameterType="MaterialDict" resultMap="MaterialDictResult">
        <include refid="selectMaterialDictVo"/>
        <where>
            (m.del_flag = '0' OR m.del_flag IS NULL)
            <if test="materialCode != null and materialCode != ''">
                AND m.material_code like concat('%', #{materialCode}, '%')
            </if>
            <if test="materialName != null and materialName != ''">
                AND m.material_name like concat('%', #{materialName}, '%')
            </if>
            <if test="categoryId != null">
                AND m.category_id = #{categoryId}
            </if>
            <if test="manufacturerId != null">
                AND m.manufacturer_id = #{manufacturerId}
            </if>
            <if test="status != null and status != ''">
                AND m.status = #{status}
            </if>
        </where>
        order by m.create_time desc
    </select>
    
    <select id="selectMaterialDictById" parameterType="Long" resultMap="MaterialDictResult">
        <include refid="selectMaterialDictVo"/>
        where m.material_id = #{materialId} and (m.del_flag = '0' OR m.del_flag IS NULL)
    </select>
    
    <select id="checkMaterialCodeUnique" parameterType="String" resultMap="MaterialDictResult">
        <include refid="selectMaterialDictVo"/>
        where m.material_code = #{materialCode} and (m.del_flag = '0' OR m.del_flag IS NULL) limit 1
    </select>
    
    <insert id="insertMaterialDict" parameterType="MaterialDict" useGeneratedKeys="true" keyProperty="materialId">
        insert into scm_material_dict(
            <if test="materialCode != null and materialCode != ''">material_code,</if>
            <if test="materialName != null and materialName != ''">material_name,</if>
            <if test="specification != null and specification != ''">specification,</if>
            <if test="model != null and model != ''">model,</if>
            <if test="unit != null and unit != ''">unit,</if>
            <if test="categoryId != null">category_id,</if>
            <if test="manufacturerId != null">manufacturer_id,</if>
            <if test="purchasePrice != null">purchase_price,</if>
            <if test="status != null and status != ''">status,</if>
            <if test="remark != null and remark != ''">remark,</if>
            <if test="createBy != null and createBy != ''">create_by,</if>
            create_time
        )values(
            <if test="materialCode != null and materialCode != ''">#{materialCode},</if>
            <if test="materialName != null and materialName != ''">#{materialName},</if>
            <if test="specification != null and specification != ''">#{specification},</if>
            <if test="model != null and model != ''">#{model},</if>
            <if test="unit != null and unit != ''">#{unit},</if>
            <if test="categoryId != null">#{categoryId},</if>
            <if test="manufacturerId != null">#{manufacturerId},</if>
            <if test="purchasePrice != null">#{purchasePrice},</if>
            <if test="status != null and status != ''">#{status},</if>
            <if test="remark != null and remark != ''">#{remark},</if>
            <if test="createBy != null and createBy != ''">#{createBy},</if>
            sysdate()
        )
    </insert>
    
    <update id="updateMaterialDict" parameterType="MaterialDict">
        update scm_material_dict
        <set>
            <if test="materialCode != null and materialCode != ''">material_code = #{materialCode},</if>
            <if test="materialName != null and materialName != ''">material_name = #{materialName},</if>
            <if test="specification != null and specification != ''">specification = #{specification},</if>
            <if test="model != null and model != ''">model = #{model},</if>
            <if test="unit != null and unit != ''">unit = #{unit},</if>
            <if test="categoryId != null">category_id = #{categoryId},</if>
            <if test="manufacturerId != null">manufacturer_id = #{manufacturerId},</if>
            <if test="purchasePrice != null">purchase_price = #{purchasePrice},</if>
            <if test="status != null and status != ''">status = #{status},</if>
            <if test="remark != null and remark != ''">remark = #{remark},</if>
            <if test="updateBy != null and updateBy != ''">update_by = #{updateBy},</if>
            update_time = sysdate()
        </set>
        where material_id = #{materialId}
    </update>
    
    <update id="deleteMaterialDictById" parameterType="Long">
        update scm_material_dict set del_flag = '2' where material_id = #{materialId}
    </update>
    
    <update id="deleteMaterialDictByIds" parameterType="String">
        update scm_material_dict set del_flag = '2' where material_id in
        <foreach item="materialId" collection="array" open="(" separator="," close=")">
            #{materialId}
        </foreach>
    </update>
</mapper>

